#!/usr/bin/env ruby

require "bundler/setup"
require "inkblot"

# You can add fixtures and/or initialization code here to make experimenting
# with your gem easier. You can also use a different console, if you like.

# (If you use this, don't forget to add pry to your Gemfile!)
require "pry"

include Inkblot # :nodoc:

# Overrides this in development
def Inkblot.vendor_path(*paths)
  @vendor_path ||= String.new(Dir.pwd).tap do |str|
    str << "/vendor"
  end

  return @vendor_path if paths.empty?

  [String.new(@vendor_path)].concat(paths).join('/')
end

# Exports and sets pulls for pins
if Gem.platforms.last.os == "linux"
  Buttons.init unless Buttons.ready?
end

### EXAMPLE COMPONENTS

## SimpleText
@t = Components::SimpleText.new do |st|
  st.div_height = st.div_width = 95
  st.text = "56%"
  st.size = 60
  st.border_size = 10
end

## IconPane with TableList frame
@b = Components::IconPane.new do |mn|
  mn.div_height = mn.div_width = :full
  
  mn.icons = :arrows
  
  mn.frame_contents = Components::TableList.new(
    items: ["Apples", "Oranges", "Pears", "Peaches"],
    div_height: (Inkblot::Display.size[:height].to_f * 0.95).floor.to_s + "px"
  )
end

## IconPane with a FullScreenImage in the frame
# @i = Components::IconPane.new do |mn|
#   mn.div_height = mn.div_width = :full
#   # TODO: FSI within other components
#   mn.frame_contents = Components::FullScreenImage.new(path: Inkblot.vendor_path('chris_kim.bmp'))
# end

## ScrollMenu with example items
@s = Components::ScrollMenu.new do |sc|
  sc.div_height = sc.div_width = :full
  sc.items = (1..10).to_a.map { |x| "Option #{x}" }
end

# Example button interaction scroll loop
def test_scroll
  Display[@s]

  menu_exit = -> { @s.state == :answered || @s.state == :canceled }

  until menu_exit.call
    Buttons.get_press
    Display.again unless menu_exit.call
  end

  scr = Components::IconPane.new do |pane|
    pane.div_height = pane.div_width = :full
    pane.icons = :cancel
    pane.frame_contents = Components::SimpleText.new do |st|
      st.text = "You picked #{@s.answer}"
      st.size = :large
      st.border_size = 1
    end
  end

  Display[scr]
  Buttons.get_input
  Display.clear
  
  @s.answer
end

Pry.start