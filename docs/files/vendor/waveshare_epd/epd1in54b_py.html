<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>epd1in54b.py</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='file' id='wrapper'>
<div class='header'>
<h1 class='name'>epd1in54b.py
</h1>
<div class='paths'>
vendor/waveshare_epd/epd1in54b.py
</div>
<div class='last-update'>
Last Update:
<span class='datetime'>2020-04-02 15:37:35 -0700</span>
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<p># ***************************************************************************** # * | File        :       epd1in54b.py # * | Author      :   Waveshare team # * | Function    :   Electronic paper driver # * | Info        : # *—————- # * | This version:   V4.0 # * | Date        :   2019-06-20 # # | Info        :   python demo # —————————————————————————– # Permission is hereby granted, free of charge, to any person obtaining a copy # of this software and associated documnetation files (the “Software”), to deal # in the Software without restriction, including without limitation the rights # to use, copy, modify, merge, publish, distribute, sublicense, and/or sell # copies of the Software, and to permit persons to  whom the Software is # furished to do so, subject to the following conditions: # # The above copyright notice and this permission notice shall be included in # all copies or substantial portions of the Software. # # THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR # IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, # FITNESS OR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE # AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER # LIABILITY WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, # OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN # THE SOFTWARE. #</p>

<p>import logging from . import epdconfig</p>

<p># Display resolution EPD_WIDTH       = 200 EPD_HEIGHT      = 200</p>

<p>class EPD:</p>

<pre>def __init__(self):&#x000A;    self.reset_pin = epdconfig.RST_PIN&#x000A;    self.dc_pin = epdconfig.DC_PIN&#x000A;    self.busy_pin = epdconfig.BUSY_PIN&#x000A;    self.cs_pin = epdconfig.CS_PIN&#x000A;    self.width = EPD_WIDTH&#x000A;    self.height = EPD_HEIGHT&#x000A;lut_vcom0 = [0x0E, 0x14, 0x01, 0x0A, 0x06, 0x04, 0x0A, 0x0A, 0x0F, 0x03, 0x03, 0x0C, 0x06, 0x0A, 0x00]&#x000A;lut_w = [0x0E, 0x14, 0x01, 0x0A, 0x46, 0x04, 0x8A, 0x4A, 0x0F, 0x83, 0x43, 0x0C, 0x86, 0x0A, 0x04]&#x000A;lut_b = [0x0E, 0x14, 0x01, 0x8A, 0x06, 0x04, 0x8A, 0x4A, 0x0F, 0x83, 0x43, 0x0C, 0x06, 0x4A, 0x04]&#x000A;lut_g1 = [0x8E, 0x94, 0x01, 0x8A, 0x06, 0x04, 0x8A, 0x4A, 0x0F, 0x83, 0x43, 0x0C, 0x06, 0x0A, 0x04]&#x000A;lut_g2 = [0x8E, 0x94, 0x01, 0x8A, 0x06, 0x04, 0x8A, 0x4A, 0x0F, 0x83, 0x43, 0x0C, 0x06, 0x0A, 0x04]&#x000A;lut_vcom1 = [0x03, 0x1D, 0x01, 0x01, 0x08, 0x23, 0x37, 0x37, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]&#x000A;lut_red0 = [0x83, 0x5D, 0x01, 0x81, 0x48, 0x23, 0x77, 0x77, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]&#x000A;lut_red1 = [0x03, 0x1D, 0x01, 0x01, 0x08, 0x23, 0x37, 0x37, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00] &#x000A;&#x000A;# Hardware reset&#x000A;def reset(self):&#x000A;    epdconfig.digital_write(self.reset_pin, 1)&#x000A;    epdconfig.delay_ms(200) &#x000A;    epdconfig.digital_write(self.reset_pin, 0) # module reset&#x000A;    epdconfig.delay_ms(10)&#x000A;    epdconfig.digital_write(self.reset_pin, 1)&#x000A;    epdconfig.delay_ms(200)   &#x000A;&#x000A;def send_command(self, command):&#x000A;    epdconfig.digital_write(self.dc_pin, 0)&#x000A;    epdconfig.digital_write(self.cs_pin, 0)&#x000A;    epdconfig.spi_writebyte([command])&#x000A;    epdconfig.digital_write(self.cs_pin, 1)&#x000A;&#x000A;def send_data(self, data):&#x000A;    epdconfig.digital_write(self.dc_pin, 1)&#x000A;    epdconfig.digital_write(self.cs_pin, 0)&#x000A;    epdconfig.spi_writebyte([data])&#x000A;    epdconfig.digital_write(self.cs_pin, 1)&#x000A;&#x000A;def ReadBusy(self):&#x000A;    logging.debug(&quot;e-Paper busy&quot;)&#x000A;    while(epdconfig.digital_read(self.busy_pin) == 0):&#x000A;        epdconfig.delay_ms(100)    &#x000A;    logging.debug(&quot;e-Paper busy release&quot;)&#x000A;&#x000A;def set_lut_bw(self):&#x000A;    self.send_command(0x20) # vcom&#x000A;    for count in range(0, 15):&#x000A;        self.send_data(self.lut_vcom0[count])&#x000A;    self.send_command(0x21) # ww --&#x000A;    for count in range(0, 15):&#x000A;        self.send_data(self.lut_w[count])&#x000A;    self.send_command(0x22) # bw r&#x000A;    for count in range(0, 15):&#x000A;        self.send_data(self.lut_b[count])&#x000A;    self.send_command(0x23) # wb w&#x000A;    for count in range(0, 15):&#x000A;        self.send_data(self.lut_g1[count])&#x000A;    self.send_command(0x24) # bb b&#x000A;    for count in range(0, 15):&#x000A;        self.send_data(self.lut_g2[count])&#x000A;&#x000A;def set_lut_red(self):&#x000A;    self.send_command(0x25)&#x000A;    for count in range(0, 15):&#x000A;        self.send_data(self.lut_vcom1[count])&#x000A;    self.send_command(0x26)&#x000A;    for count in range(0, 15):&#x000A;        self.send_data(self.lut_red0[count])&#x000A;    self.send_command(0x27)&#x000A;    for count in range(0, 15):&#x000A;        self.send_data(self.lut_red1[count])&#x000A;&#x000A;def init(self):&#x000A;    if (epdconfig.module_init() != 0):&#x000A;        return -1&#x000A;    # EPD hardware init start&#x000A;    self.reset()&#x000A;&#x000A;    self.send_command(0x01) # POWER_SETTING&#x000A;    self.send_data(0x07)&#x000A;    self.send_data(0x00)&#x000A;    self.send_data(0x08)&#x000A;    self.send_data(0x00)&#x000A;    self.send_command(0x06) # BOOSTER_SOFT_START&#x000A;    self.send_data(0x07)&#x000A;    self.send_data(0x07)&#x000A;    self.send_data(0x07)&#x000A;    self.send_command(0x04) # POWER_ON&#x000A;&#x000A;    self.ReadBusy()&#x000A;&#x000A;    self.send_command(0X00) # PANEL_SETTING&#x000A;    self.send_data(0xCF)&#x000A;    self.send_command(0X50) # VCOM_AND_DATA_INTERVAL_SETTING&#x000A;    self.send_data(0x17)&#x000A;    self.send_command(0x30) # PLL_CONTROL&#x000A;    self.send_data(0x39)&#x000A;    self.send_command(0x61) # TCON_RESOLUTION set x and y&#x000A;    self.send_data(0xC8)&#x000A;    self.send_data(0x00)&#x000A;    self.send_data(0xC8)&#x000A;    self.send_command(0x82) # VCM_DC_SETTING_REGISTER&#x000A;    self.send_data(0x0E)&#x000A;&#x000A;    self.set_lut_bw()&#x000A;    self.set_lut_red()&#x000A;    return 0&#x000A;&#x000A;def getbuffer(self, image):&#x000A;    buf = [0xFF] * int(self.width * self.height / 8)&#x000A;    # Set buffer to value of Python Imaging Library image.&#x000A;    # Image must be in mode 1.&#x000A;    image_monocolor = image.convert(&#39;1&#39;)&#x000A;    imwidth, imheight = image_monocolor.size&#x000A;    if imwidth != self.width or imheight != self.height:&#x000A;        raise ValueError(&#39;Image must be same dimensions as display \&#x000A;            ({0}x{1}).&#39; .format(self.width, self.height))&#x000A;&#x000A;    pixels = image_monocolor.load()&#x000A;    for y in range(self.height):&#x000A;        for x in range(self.width):&#x000A;            # Set the bits for the column of pixels at the current position.&#x000A;            if pixels[x, y] == 0:&#x000A;                buf[int((x + y * self.width) / 8)] &amp;= ~(0x80 &gt;&gt; (x % 8))&#x000A;    return buf&#x000A;&#x000A;def display(self, blackimage, redimage):&#x000A;    # send black data&#x000A;    if (blackimage != None):&#x000A;        self.send_command(0x10) # DATA_START_TRANSMISSION_1&#x000A;        for i in range(0, int(self.width * self.height / 8)):&#x000A;            temp = 0x00&#x000A;            for bit in range(0, 4):&#x000A;                if (blackimage[i] &amp; (0x80 &gt;&gt; bit) != 0):&#x000A;                    temp |= 0xC0 &gt;&gt; (bit * 2)&#x000A;            self.send_data(temp)  &#x000A;            temp = 0x00&#x000A;            for bit in range(4, 8):&#x000A;                if (blackimage[i] &amp; (0x80 &gt;&gt; bit) != 0):&#x000A;                    temp |= 0xC0 &gt;&gt; ((bit - 4) * 2)&#x000A;            self.send_data(temp)&#x000A;&#x000A;    # send red data        &#x000A;    if (redimage != None):&#x000A;        self.send_command(0x13) # DATA_START_TRANSMISSION_2&#x000A;        for i in range(0, int(self.width * self.height / 8)):&#x000A;            self.send_data(redimage[i])  &#x000A;&#x000A;    self.send_command(0x12) # DISPLAY_REFRESH&#x000A;    self.ReadBusy()&#x000A;&#x000A;def Clear(self):&#x000A;    self.send_command(0x10) # DATA_START_TRANSMISSION_1&#x000A;    for i in range(0, int(self.width * self.height / 8)):&#x000A;        self.send_data(0xFF)&#x000A;        self.send_data(0xFF)&#x000A;&#x000A;    self.send_command(0x13) # DATA_START_TRANSMISSION_2&#x000A;    for i in range(0, int(self.width * self.height / 8)):&#x000A;        self.send_data(0xFF)&#x000A;&#x000A;    self.send_command(0x12) # DISPLAY_REFRESH&#x000A;    self.ReadBusy()&#x000A;&#x000A;def sleep(self):&#x000A;    self.send_command(0x50) # VCOM_AND_DATA_INTERVAL_SETTING&#x000A;    self.send_data(0x17)&#x000A;    self.send_command(0x82) # to solve Vcom drop &#x000A;    self.send_data(0x00)        &#x000A;    self.send_command(0x01) # power setting      &#x000A;    self.send_data(0x02) # gate switch to external&#x000A;    self.send_data(0x00)&#x000A;    self.send_data(0x00) &#x000A;    self.send_data(0x00) &#x000A;    self.ReadBusy()&#x000A;&#x000A;    self.send_command(0x02) # power off&#x000A;&#x000A;    epdconfig.module_exit()</pre>

<p>### END OF FILE ###</p>
</div>
<div id='context'>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/rdoc/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
